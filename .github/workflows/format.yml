name: Format & Lint

on:
  push:
    branches: [ '**' ]
  pull_request:
    branches: [ main, develop ]

jobs:
  format:
    name: Format check avec Ruff
    runs-on: ubuntu-22.04

    defaults:
      run:
        working-directory: backend
    
    steps:
    - name: Récupérer le code
      uses: actions/checkout@v4
    
    - name: Installer uv
      uses: astral-sh/setup-uv@v4
      with:
        version: "latest"
        enable-cache: true
    
    - name: Configurer Python
      run: uv python install 3.13
    
    - name: Installer les dépendances
      run: uv sync --dev
 
    - name: Vérification format avec Ruff
      run: uv run ruff format --check

  lint:
    name: Linting avec Ruff
    runs-on: ubuntu-22.04

    defaults:
      run:
        working-directory: backend
    
    steps:
    - name: Récupérer le code
      uses: actions/checkout@v4
    
    - name: Installer uv
      uses: astral-sh/setup-uv@v4
      with:
        version: "latest"
        enable-cache: true
    
    - name: Configurer Python
      run: uv python install 3.13
    
    - name: Installer les dépendances
      run: uv sync --dev
    
    - name: Vérification lint avec Ruff
      run: uv run ruff check .